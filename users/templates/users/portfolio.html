{% extends "base.html" %}
{% block title %}Мой портфель — {{ block.super }}{% endblock %}

{% block content %}
<div style="display:flex; gap:24px; align-items:flex-start;">

  <!-- ===================== Левая колонка: Портфель ===================== -->
  <div style="flex:1 1 auto; min-width:580px;">
    <h1 style="margin:0 0 8px;">{{ request.user.get_full_name|default:request.user.username }}</h1>

    {% if request.user.is_authenticated %}
      <img src="{{ request.user.profile.avatar_url }}" alt=""
           style="height:96px;width:96px;border-radius:90%;object-fit:cover;margin-bottom:8px;">
    {% endif %}

    <p style="margin:0 0 12px;"><strong>Баланс:</strong> {{ request.user.profile.balance }} мон.</p>

    <div style="
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin: 0 0 16px;
">

  {% if request.user.profile.google_doc_url %}
    <a href="{{ request.user.profile.google_doc_url }}" target="_blank" rel="noopener"
       style="
         display:inline-block;
         padding:10px 18px;
         background:#4F46E5;
         color:#ffffff;
         text-decoration:none;
         border-radius:8px;
         font-weight:500;
         font-size:14px;
       ">
      Мой документ в Google Docs →
    </a>
  {% endif %}

  {% if request.user.profile.resume_url %}
    <a href="{{ request.user.profile.resume_url }}" target="_blank" rel="noopener"
       style="
         display:inline-block;
         padding:10px 18px;
         background:#10B981;
         color:#ffffff;
         text-decoration:none;
         border-radius:8px;
         font-weight:500;
         font-size:14px;
       ">
      Моё резюме →
    </a>
  {% endif %}

  {% if request.user.profile.resume_example %}
    <a href="{{ request.user.profile.resume_example }}" target="_blank" rel="noopener"
       style="
         display:inline-block;
         padding:10px 18px;
         background:#0EA5E9;
         color:#ffffff;
         text-decoration:none;
         border-radius:8px;
         font-weight:500;
         font-size:14px;
       ">
      Пример резюме →
    </a>
  {% endif %}

  {% if request.user.profile.task_url %}
    <a href="{{ request.user.profile.task_url }}" target="_blank" rel="noopener"
       style="
         display:inline-block;
         padding:10px 18px;
         background:#F97316;
         color:#ffffff;
         text-decoration:none;
         border-radius:8px;
         font-weight:500;
         font-size:14px;
       ">
      Задание!
    </a>
  {% endif %}

  <a href="https://drive.google.com/drive/u/0/folders/13ov5Vr9KNpgRFUimY1o5F1mnTxBxlKvb"
     target="_blank" rel="noopener"
     style="
       display:inline-block;
       padding:10px 18px;
       background:#6B7280;
       color:#ffffff;
       text-decoration:none;
       border-radius:8px;
       font-weight:500;
       font-size:14px;
     ">
    Инструкции для оформления заявления
  </a>

</div>

    <table style="width:100%; max-width:820px; border-collapse:collapse; font-size:14px;">
      <thead>
        <tr style="background:#f6f6f6; text-align:left;">
          <th style="padding:10px 8px; width:56px;">Иконка</th>
          <th style="padding:10px 8px;">Товар</th>
          <th style="padding:10px 8px; width:90px;">Кол-во</th>
          <th style="padding:10px 8px; width:130px;">Текущая цена</th>
          <th style="padding:10px 8px; width:160px;">Стоимость позиции</th>
        </tr>
      </thead>
      <tbody>
        {% if holdings %}
          {% for h in holdings %}
            <tr style="border-top:1px solid #eee; {% if forloop.counter0|divisibleby:2 %}background:#fafafa;{% endif %}">
              <td style="padding:8px;">
                {% if h.product.image %}
                  <img src="{{ h.product.image.url }}" alt="{{ h.product.title }}"
                       style="width:48px;height:48px;object-fit:cover;border-radius:8px;display:block;">
                {% else %}
                  <img src="/media/products/product_placeholder.svg" alt="{{ h.product.title }}"
                       style="width:48px;height:48px;object-fit:cover;border-radius:8px;display:block;opacity:.7;">
                {% endif %}
              </td>
              <td style="padding:8px;">
                <a href="{{ h.product.get_absolute_url }}" style="font-weight:600; text-decoration:none;">
                  {{ h.product.title }}
                </a>
                <div style="color:#666; font-size:12px; margin-top:2px;">
                  {{ h.product.category.name }}
                </div>
              </td>
              <td style="padding:8px;">{{ h.quantity }}</td>
              <td style="padding:8px;">{{ h.product.price }} мон.</td>
              <td style="padding:8px; font-weight:600;">{{ h.position_value }} мон.</td>
            </tr>
          {% endfor %}
          <tr style="border-top:2px solid #ddd;">
            <td colspan="4" style="padding:10px 8px; text-align:right;"><strong>Итого по портфелю:</strong></td>
            <td style="padding:10px 8px; font-weight:700;">{{ total_positions }} мон.</td>
          </tr>
        {% else %}
          <tr>
            <td colspan="5" style="padding:14px; text-align:center; color:#666;">Владений пока нет</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <!-- ===================== Правая колонка: Мои товары ===================== -->
  <aside style="width:360px; flex:0 0 360px;">
    <h3 style="margin:0 0 8px;">Мои товары</h3>
    <p style="margin:0 0 12px; color:#666;">
      Создано: {{ my_products|length }}.
      <a href="{% url 'catalog:create' %}">Добавить товар</a>
    </p>

    {% if my_products %}
      <ul style="list-style:none; padding:0; margin:0; display:grid; gap:10px;">
        {% for p in my_products %}
          <li style="display:flex; gap:10px; align-items:center; border:1px solid #e6e6e6; border-radius:10px; padding:8px;">
            <a href="{{ p.get_absolute_url }}" style="display:block">
              {% if p.image %}
                <img src="{{ p.image.url }}" alt="{{ p.title }}"
                     style="width:64px;height:64px;object-fit:cover;border-radius:8px;display:block;">
              {% else %}
                <img src="/media/products/product_placeholder.svg" alt="{{ p.title }}"
                     style="width:64px;height:64px;object-fit:cover;border-radius:8px;display:block;opacity:.7;">
              {% endif %}
            </a>
            <div style="min-width:0;">
              <div style="font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                <a href="{{ p.get_absolute_url }}" style="text-decoration:none;">{{ p.title }}</a>
              </div>
              <div style="color:#666; font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                {{ p.category.name }} • {{ p.price }} мон.
              </div>
              <div style="font-size:12px; margin-top:4px;">
                {% if p.is_approved %}
                  <span style="color:green;">✓ Одобрен</span>
                {% else %}
                  <span style="color:#b45309;">⏳ На модерации</span>
                {% endif %}
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div style="border:1px dashed #ccc; border-radius:10px; padding:12px; color:#666;">
        Вы ещё не создали ни одного товара.
        <br><a href="{% url 'catalog:create' %}">Создать первый товар →</a>
      </div>
    {% endif %}
  </aside>

</div>
{% endblock %}
