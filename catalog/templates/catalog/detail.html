{% extends "base.html" %}
{% block title %}{{ object.title }} — {{ block.super }}{% endblock %}

{% block content %}
<div class="section">
  <a href="{% url 'catalog:list' %}" class="muted">← Назад в каталог</a>
</div>
<section class="card product-detail">
  <div>
    {% if object.image %}
      <img src="{{ object.image.url }}" alt="{{ object.title }}" class="product-detail__image">
    {% else %}
      <img src="/media/products/product_placeholder.svg" alt="{{ object.title }}" class="product-detail__image">
    {% endif %}
  </div>
  <div class="stack">
    <div>
      <h1 class="page-title">{{ object.title }}</h1>
      <p class="muted">{{ object.category.name }}</p>
      {% if not product.is_approved %}
        <span class="status-pill">⏳ На модерации</span>
      {% else %}
        <span class="status-pill status-pill--success">✓ Одобрен</span>
      {% endif %}
    </div>


    {% if user.is_authenticated and product.created_by_id == None %}
  {% if not product.pending_owner or product.pending_owner_id == user.id %}
        <a href="{% url 'catalog:claim' product.pk %}" class="button button--soft">Заполнить описание и изображение</a>
      {% else %}
        <p class="muted">На модерации у: {{ product.pending_owner.get_full_name|default:product.pending_owner.username }}</p>
      {% endif %}
    {% endif %}

<p>{{ object.description }}</p>
    <div class="card card--flat">
      <div class="stack">
        <div class="toolbar">
          <span class="muted">Цена</span>
          <strong>{{ object.price }} мон.</strong>
        </div>
        <div class="toolbar">
          <span class="muted">В наличии</span>
          <strong>{{ object.stock }}</strong>
        </div>
      </div>
    </div>
{% if user.is_authenticated %}
      <div class="stack">
        <div>
          <h3>Купить</h3>
          <form method="post" action="{% url 'trade:buy' object.id %}" class="inline-form">
            {% csrf_token %}
            <input type="number" name="quantity" min="1" value="1" required>
            <button type="submit" class="button button--primary">Купить</button>
          </form>
        </div>
        <div>
          <h3>Продать</h3>
          <form method="post" action="{% url 'trade:sell' object.id %}" class="inline-form">
            {% csrf_token %}
            <input type="number" name="quantity" min="1" value="1" required>
            <button type="submit" class="button button--ghost">Продать</button>
          </form>
        </div>
      </div>
    {% else %}
      <p><a href="{% url 'login' %}">Войдите</a>, чтобы торговать.</p>
    {% endif %}
  </div>
</section>


{% endblock %}
